<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Управление бэкапами — Admin</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .backup-actions { display:flex; gap:8px; flex-wrap:wrap; }
        .backup-info { font-size:12px; color:#7f8c8d; }
        .warning-box {
            background:#fff3cd;
            border:1px solid #ffc107;
            padding:12px;
            border-radius:8px;
            margin:12px 0;
            color:#856404;
        }
        .danger-box {
            background:#f8d7da;
            border:1px solid #dc3545;
            padding:12px;
            border-radius:8px;
            margin:12px 0;
            color:#721c24;
        }
        .btn-danger {
            background:#dc3545;
            color:white;
        }
        .btn-danger:hover {
            background:#c82333;
        }
        .btn-warning {
            background:#ffc107;
            color:#212529;
        }
        .btn-warning:hover {
            background:#e0a800;
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Управление бэкапами базы данных</h1>
        <div>
            <a class="btn" href="/admin">Панель</a>
            <a class="btn" href="/admin/users">Пользователи</a>
            <a class="btn" href="/admin/audit">Журнал</a>
            <a class="btn" href="/admin/data">Обзор</a>
            <a class="btn" href="/admin/backups" style="font-weight:bold;">Бэкапы</a>
            <a class="btn" href="/admin/settings">Настройки</a>
            <form method="post" th:action="@{/logout}" style="display:inline;">
                <button class="btn" type="submit">Выйти</button>
            </form>
        </div>
    </header>

    <div th:if="${success}" class="success-message">
        <p th:text="${success}"></p>
    </div>

    <div th:if="${error}" class="error-message">
        <p th:text="${error}"></p>
    </div>

    <div class="card">
        <h2>Создать новый бэкап</h2>
        <div class="warning-box">
            <strong>Внимание:</strong> Создание бэкапа может занять некоторое время в зависимости от размера базы данных.
            Во время создания бэкапа система будет доступна.
        </div>
        <form method="post" action="/admin/backups/create" onsubmit="return confirm('Создать бэкап базы данных?');">
            <button class="btn" type="submit">Создать бэкап</button>
        </form>
    </div>

    <div class="card" style="margin-top:20px;">
        <h2>Доступные бэкапы (<span th:text="${backups != null ? backups.size() : 0}">0</span>)</h2>

        <div th:if="${backups != null and !backups.isEmpty()}">
            <table class="table">
                <thead>
                    <tr>
                        <th>Файл</th>
                        <th>Размер</th>
                        <th>Дата создания</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="backup : ${backups}">
                        <td>
                            <strong th:text="${backup.filename}">backup.bak</strong>
                            <div class="backup-info" th:text="${backup.path}">path</div>
                        </td>
                        <td th:text="${backup.getFormattedSize()}">1.2 MB</td>
                        <td th:text="${backup.getFormattedDate()}">2025-11-25 10:30:00</td>
                        <td>
                            <div class="backup-actions">
                                <a th:href="@{'/admin/backups/download/' + ${backup.filename}}"
                                   class="btn"
                                   title="Скачать бэкап">
                                    Скачать
                                </a>
                                <form method="post"
                                      th:action="@{'/admin/backups/delete/' + ${backup.filename}}"
                                      style="display:inline;"
                                      onsubmit="return confirm('Удалить бэкап?');">
                                    <button class="btn btn-danger" type="submit" title="Удалить бэкап">
                                        Удалить
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div th:if="${backups == null or backups.isEmpty()}" class="empty-message">
            <p>Бэкапов пока нет. Создайте первый бэкап используя кнопку выше.</p>
        </div>
    </div>

    <div class="card" style="margin-top:20px;">
        <h2>Информация</h2>
        <ul style="line-height:1.8;">
            <li><strong>Создание бэкапа:</strong> создаёт полную копию базы данных в файл .bak</li>
            <li><strong>Скачивание:</strong> позволяет сохранить бэкап на локальный компьютер для безопасного хранения</li>
            <li><strong>Удаление:</strong> удаляет файл бэкапа с сервера</li>
        </ul>

        <div class="warning-box" style="margin-top:12px;">
            <strong>Рекомендации:</strong>
            <ul style="margin:8px 0 0 20px;">
                <li>Регулярно создавайте бэкапы (ежедневно или еженедельно)</li>
                <li>Скачивайте бэкапы и храните их в безопасном месте вне сервера</li>
                <li>Периодически проверяйте целостность бэкапов</li>
                <li>Удаляйте старые бэкапы для экономии места на диске</li>
                <li>Для восстановления БД используйте SQL Server Management Studio</li>
            </ul>
        </div>
    </div>
</div>
</body>
</html>
